
# 基于深度强化学习的流处理资源分配

## 问题

将流处理图的计算任务划分到计算设备上的资源分配策略必须同时平衡工作负载分布并最小化通信。

把算子的分区问题近似为分区图的搜索。

## 方法

我们提出了一个图形感知的encoderdecoder框架，学习一个可推广的资源分配策略，可以适当地分配计算任务的流处理图未观察到的训练数据。我们首次提出利用图嵌入来学习流处理图的结构信息。使用深度强化学习与图形感知解码器联合训练，我们的方法可以有效地为未见过的图形找到优化的解决方案。
![[整體流程.png]]


### 构建图



![[流圖構建過程.png]]


节点是带有 CPU 利用率（每秒执行的CPU指令数）和负载（每秒生成的数据量）的算子。

有向边是的权重是两个算子之间的通信成本。

节点下面的数字是分配到的物理机，假设他们不同的物理机之都是相同的。

资源分配不仅取决于流图的拓扑，还取决于物理机的分配，因此把他转换成每一步将一个设备id节点附加到Gx中的每个操作符节点的搜索问题。相当于图生成图。



### 图嵌入（编码）

每个节点具有在图中对其上下文信息进行编码的嵌入，该嵌入为其放置预测提供信息。包含其从上游和下游算子中得到的信息。

### 解码器（为每个算子分配设备）

由于算子的吞吐量更多地受上游的影响，因此，解码器首先从上游的算子开始分配任务。并将之前的分配结果作为LSTM的输入，得到下个结果的分配。


### 使用强化学习进行训练

最大化 **相对吞吐量**， $r(G_y) = \frac{T(G_y)}{I(G_x)}$ 即 $G_y$ 吞吐量和 $G_x$ 的输入速率的比值。确保不会产生背压。

## 提升原因

把一个分支的算子尽量分配在一个设备上。
![[算子分配.png]]


## 优点

1. 适用不同的流图 拓扑形式
2. 根据流图的工作负载自动找到正确数量的设备

